#!/usr/bin/env ruby
require_relative '../lib/flick'
require 'commander/import'

program :version, '0.0.1'
program :description, 'A CLI to capture screenshots and video for Android (Devices & Emulators) and iOS (Devices).'

command :start do |c|
  c.syntax = 'flick start [options]'
  c.description = 'Start video recording'
  c.example 'description', 'flick start -p android -u TA64300B9C'
  c.option '-p', '--platform PLATFORM', String, 'Set platform: android or ios'
  c.option '-u', '--udid UDID', String, 'Set device UDID.'
  c.option '-s', '--seconds SECONDS', String, 'Set the seconds per screenshot. Default: 0.5'
  c.option '-c', '--count COUNT', Integer, 'Set maximum number of screenshots. Default: 500'
  c.option '-e', '--extend EXTEND', 'Extend android video recording past 180 seconds for REAL devices. Default: false'
  c.action do |args, options|
    options.default \
    :seconds => 0.5, #Seconds per screenshot.
    :count => 500, #This is a safety check to stop runaway screenshot process.
    :extend => false, #Extend android video recording (for REAL devices and os >= 4.4) past 180 seconds.
    :outdir => Dir.pwd
    
    Video.new(options.default).start
  end
end

command :stop do |c|
  c.syntax = 'flick stop [options]'
  c.summary = 'Stop video recording'
  c.description = c.summary
  c.example 'description', 'flick stop -p android'
  c.option '-p', '--platform PLATFORM', String, 'Set platform: android or ios'
  c.option '-u', '--udid UDID', String, 'Set device UDID'
  c.option '-n', '--name NAME', String, "Set name of output file, Default: UDID"
  c.option '-q', '--unique UNIQUE', 'Pull only unique screenshots. Significantly speeds up the pulling process. Default: true'
  c.option '-o', '--outdir OUTDIR', String, "Set output directory. Default is #{Dir.pwd}"
  c.action do |args, options|
    options.default \
    :unique => true, #defaults to pulling only unique screenshots. Speeds up pulling process from device.
    :outdir => Dir.pwd #defaults to save in current dir.
    
    Video.new(options.default).stop
  end
end

command :screenshot do |c|
  c.syntax = 'flick screenshot [options]'
  c.summary = 'Take a screenshot'
  c.description = c.summary
  c.example 'description', 'flick screenshot -p ios'
  c.option '-p', '--platform PLATFORM', String, 'Set platform: android or ios'
  c.option '-u', '--udid UDID', String, 'Set device UDID.'
  c.option '-n', '--name NAME', String, "Set name of output file. Default: UDID"
  c.option '-o', '--outdir OUTDIR', String, "Set output directory. Default is #{Dir.pwd}"
  c.action do |args, options|
    options.default \
    :outdir => Dir.pwd #defaults to save in current dir.
    
    Screenshot.new(options.default).screenshot
  end
end